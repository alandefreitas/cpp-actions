= Create Flamegraph [[flamegraph]]
:reftext: Create Flamegraph
:navtitle: Create Flamegraph Action
// This flamegraph.adoc file is automatically generated.
// Edit parse_actions.py instead.

This action merges time-trace files generated by Clang and generates a FlameGraph.

To generate the files, build the project with Clang and the -ftime-trace flag.
For every object file, there will be a corresponding json file with details about build time.

Each file in the build-dir will be combined into a single output file that contains
all traces.

The combined time-trace file is uploaded to artifacts and can be visualized with

- https://www.speedscope.app/ or https://github.com/jlfwong/speedscope
- https://github.com/brendangregg/FlameGraph or https://www.brendangregg.com/flamegraphs.html

A simple analysis can be performed with:

- https://github.com/aras-p/ClangBuildAnalyzer

The combined time-trace is also converted to an image with https://github.com/brendangregg/FlameGraph.
This image is appended to the job step summary.


== Example

[source,yml,subs="attributes+"]
----
steps:
- name: FlameGraph
  uses: alandefreitas/cpp-actions/flamegraph@{page-version}
  with:
    source-dir: tests
    build-dir: tests/build
    github_token: ${{ secrets.GITHUB_TOKEN }}
----

== Input Parameters

|===
|Parameter |Description |Default
|`source-dir` |The source directory used to generate time-traces. This should usually be your build directory.
. |`.`
|`build-dir` |The directory with the time-traces. This should usually be your build directory.
. |`.`
|`output-path` |The path where the combined traces will be stored.

If this is a relative path, it will be made relative to the build-dir.
. |`combined-traces.json`
|`report-path` |The path where the report will be stored.

If this is a relative path, it will be made relative to the build-dir.
. |`time-trace-report.md`
|`generate-svg` |Generate SVG file with the output. |`true`
|`generate-report` |Generate a small report with ClangBuildAnalyzer. |`true`
|`update-summary` |Update action summary with the SVG file. |`true`
|`github_token` |An imgur client ID to upload the SVG flamegraph.

See https://api.imgur.com/
. |
|`upload-artifact` |Upload combined traces as artifact. |`true`
|`trace-commands` |Trace commands executed by the workflow. |`false`
|===

== Outputs

|===
|Output |Description
|`traces-path` |The absolute path to combined traces.
|`svg-path` |The absolute path to svg file.
|===
